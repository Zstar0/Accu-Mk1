---
wave: 1
autonomous: false
---

# Phase 3 Plan 2: Batch Review UI

**Summary**: Create BatchReview component showing all samples in a job with calculated results (purity, retention time, compound ID) in a table format.

## Goal Backward

**Phase Goal**: Operator can review batch, approve/reject samples, filter/sort results

**This Plan Must Deliver**:
- User can select a job/batch to review
- User sees all samples in table with key data columns
- Table shows: filename, status, purity, retention time, compound ID
- Data fetched from backend with TanStack Query

## Must-Haves (What Must Be TRUE)

### Truths
- BatchReview component displays samples in a data table
- Each row shows: filename, status, purity %, retention time, compound ID
- Data loads from /jobs/{id}/samples with their results
- Loading and empty states handled

### Artifacts
- `src/components/BatchReview.tsx`: Main review component with table
- `src/lib/api.ts`: getSamplesWithResults() function (or extend existing)
- `backend/main.py`: Endpoint to get samples with their results (or combine existing)

### Key Links
- BatchReview fetches job samples via TanStack Query
- Each sample row displays calculation results from Result records
- MainWindowContent can show BatchReview when job selected

## Tasks

### Task 1: Create samples with results API endpoint

**Objective**: Single endpoint returns samples with their calculation results

**Checklist**:
- [ ] GET /jobs/{id}/samples-with-results returns samples with nested results
- [ ] Response includes purity, retention_time, compound_id from Result output_data
- [ ] Flatten key calculation values for easy UI consumption

**Commit**: `feat(03-02): add samples-with-results endpoint`

### Task 2: Add TypeScript types and API function

**Objective**: Frontend types for samples with results

**Checklist**:
- [ ] Add SampleWithResults interface (sample + calculated values)
- [ ] Add getSamplesWithResults(jobId) function
- [ ] Include purity, retention_time, compound_id as top-level fields

**Commit**: `feat(03-02): add getSamplesWithResults API function`

### Task 3: Create BatchReview component

**Objective**: Table UI showing samples with results

**Checklist**:
- [ ] BatchReview component with job selector and data table
- [ ] Use shadcn/ui Table components for layout
- [ ] Columns: filename, status (badge), purity, RT, compound
- [ ] Loading spinner while fetching
- [ ] Empty state when no samples
- [ ] checkpoint:human-verify - User verifies table displays correctly

**Commit**: `feat(03-02): add BatchReview component with sample table`

## Verification

checkpoint:human-verify

1. Start backend: `uvicorn main:app --port 8009 --reload`
2. Import some test files via FileSelector
3. Run calculations on imported samples
4. Open BatchReview and select the job
5. Verify table shows all samples with their calculated values

## Dependencies

- Requires: Phase 2 (samples, results, calculations exist)
- Provides: Table UI for reviewing samples
- Affects: 03-03 (will add action buttons to this table)

## Scope

- Tasks: 3
- Estimated context: 40%
