---
wave: 3
autonomous: false
---

# Phase 3 Plan 4: Filter and Sort

**Summary**: Add filter controls (by status, compound) and sortable columns to BatchReview table.

## Goal Backward

**Phase Goal**: Operator can review batch, approve/reject samples, filter/sort results

**This Plan Must Deliver**:
- User can filter samples by status (all, pending, calculated, approved, rejected)
- User can filter samples by compound
- User can click column headers to sort by any column
- Filter state persists during session

## Must-Haves (What Must Be TRUE)

### Truths
- Filter dropdown for status with all/pending/calculated/approved/rejected options
- Filter dropdown for compound (populated from available compounds)
- Column headers are clickable for sorting
- Sort toggles between ascending/descending
- Filters apply client-side (data already loaded)
- Clear filters button to reset

### Artifacts
- `src/components/BatchReview.tsx`: Filter controls and sortable headers
- Client-side filtering and sorting logic
- Filter state managed locally or in Zustand

### Key Links
- Status filter → filters samples array by status field
- Compound filter → filters samples by compound_id result
- Column click → sorts samples array by that field
- All changes update table display immediately

## Tasks

### Task 1: Add filter controls to BatchReview

**Objective**: UI for filtering samples

**Checklist**:
- [ ] Status filter using shadcn Select component
- [ ] Compound filter populated from unique compounds in data
- [ ] Clear filters button
- [ ] Filter controls above table

**Commit**: `feat(03-04): add filter controls to BatchReview`

### Task 2: Implement client-side filtering logic

**Objective**: Filter samples based on selected criteria

**Checklist**:
- [ ] useState for statusFilter and compoundFilter
- [ ] useMemo to compute filtered samples
- [ ] Status filter matches sample.status
- [ ] Compound filter matches compound_id from results

**Commit**: `feat(03-04): implement sample filtering logic`

### Task 3: Add sortable column headers

**Objective**: Click-to-sort functionality

**Checklist**:
- [ ] useState for sortColumn and sortDirection
- [ ] Column headers show sort indicator (arrow up/down)
- [ ] Click toggles: none → asc → desc → none
- [ ] useMemo to compute sorted samples (after filtering)
- [ ] checkpoint:human-verify - User tests filter and sort

**Commit**: `feat(03-04): add sortable columns to BatchReview`

## Verification

checkpoint:human-verify

1. Open BatchReview with samples in various statuses
2. Select "approved" status filter - verify only approved samples show
3. Select a compound filter - verify samples filter by compound
4. Click Purity column header - verify samples sort by purity
5. Click again - verify sort direction reverses
6. Click Clear filters - verify all samples show again

## Dependencies

- Requires: 03-02 (BatchReview table), 03-03 (status values in use)
- Provides: Complete review workflow with filter/sort
- Affects: None (final Phase 3 plan)

## Scope

- Tasks: 3
- Estimated context: 30%
